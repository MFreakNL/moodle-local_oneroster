define(["jquery","core/ajax","core/notification","core/templates","core/str"],function(a,b,c,d,e){return{init:function(){a(document).ready(function(){a("input:checkbox").prop("checked",!1),a("#multiselect-districs").change(function(){console.log("#multiselect-districs is changed!")}),a("#multiselect-schools").change(function(){var e=a(this),f=e.val(),g=a("#tbl-classes"),h=e.find("option:selected"),i=parseInt(h.attr("data-categoryid"));a("input:checkbox").prop("checked",!1),i>0?a(".btn-action").prop("disabled",!1):a(".btn-action").prop("disabled",!0),e.css("background","url("+M.util.image_url("i/loading","moodle")+") no-repeat center center"),b.call([{methodname:"local_oneroster_get_external_classes",args:{schoolid:f},done:function(a){d.render("local_oneroster/classes",a).done(function(a){e.css("background",""),g.empty(),g.append(a),g.css("background","")}).fail(c.exception)},fail:c.exception}])}),a("#btn-create-school").click(function(){var d=a("#multiselect-schools"),f=d.val(),g=d.find("option:selected"),h=parseInt(g.attr("data-categoryid"));0===h&&f>0&&e.get_strings([{key:"confirm",component:"moodle"},{key:"createschoolconfirm",component:"local_oneroster"},{key:"yes",component:"moodle"},{key:"cancel",component:"moodle"},{key:"schoolcreatedsuccessfully",component:"local_oneroster"}]).done(function(d){c.confirm(d[0],d[1],d[2],d[3],function(){b.call([{methodname:"local_oneroster_create_school",args:{schoolid:f},done:function(b){b.categoryid>0?(g.attr("data-categoryid",b.categoryid),a(".btn-action").prop("disabled",!1),c.alert(null,d[4])):c.alert(null,b.message)},fail:c.exception}])})}).fail(c.exception)}),a(".btn-enrol").click(function(){var f=a("#multiselect-schools").val(),g=a("#tbl-classes"),h=parseInt(a(this).attr("data-unenrol")),i=[];a("input[name='level[]']:checked").each(function(){i.push(a(this).val())});var j=[];a("input[name='classes[]']:checked").each(function(){j.push(a(this).val())}),j.length>0&&i.length>0?e.get_strings([{key:"confirm",component:"moodle"},{key:"enrollclassesconfirm",component:"local_oneroster",param:h>0?"unenroll":"enroll"},{key:"yes",component:"moodle"},{key:"cancel",component:"moodle"},{key:"taskscheduled",component:"local_oneroster"},{key:"failed",component:"local_oneroster"}]).done(function(e){c.confirm(e[0],e[1],e[2],e[3],function(){b.call([{methodname:"local_oneroster_create_level",args:{classids:j,levels:i,unenroll:h},done:function(h){h?(c.alert(null,e[4]),b.call([{methodname:"local_oneroster_get_external_classes",args:{schoolid:f},done:function(a){d.render("local_oneroster/classes",a).done(function(a){g.empty(),g.append(a)}).fail(c.exception)},fail:c.exception}])):c.alert(null,e[5]),a("input:checkbox").prop("checked",!1)},fail:c.exception}])})}).fail(c.exception):e.get_strings([{key:"chooseclassandlevel",component:"local_oneroster"}]).done(function(a){c.alert(null,a[0])})}),a("#btn-sync-members").click(function(){var d=a("#multiselect-schools").val();a("#tbl-classes");d>0?e.get_strings([{key:"confirm",component:"moodle"},{key:"syncmembersconfirm",component:"local_oneroster"},{key:"yes",component:"moodle"},{key:"cancel",component:"moodle"},{key:"synced",component:"local_oneroster"},{key:"failed",component:"local_oneroster"}]).done(function(e){c.confirm(e[0],e[1],e[2],e[3],function(){b.call([{methodname:"local_oneroster_sync_members",args:{schoolid:d},done:function(f){f?(c.alert(null,e[4]),b.call([{methodname:"local_oneroster_sync_members",args:{schoolid:d},done:function(a){a?c.alert(null,e[4]):c.alert(null,e[5])},fail:c.exception}])):c.alert(null,e[5]),a("input:checkbox").prop("checked",!1)},fail:c.exception}])})}).fail(c.exception):e.get_strings([{key:"chooseclassandlevel",component:"local_oneroster"}]).done(function(a){c.alert(null,a[0])})})})}}});